{"ast":null,"code":"var _jsxFileName = \"D:\\\\Libr\\\\front\\\\src\\\\Page\\\\SystemInfo.jsx\";\nimport React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport TableSheme from '../Components/Table/TableSheme';\nimport Navbar from '../Components/Navbar/Navbar';\nimport { useParams } from 'react-router-dom';\nimport { useHttp } from '../hooks/http.hook';\nimport { useMessage } from '../hooks/message.hook';\n\nfunction SystemInfo(props) {\n  const [items, setItems] = useState([]);\n  const [info_system, setInfo_system] = useState([]);\n  const [isLoaded, setIsLoaded] = useState(false);\n  const message = useMessage();\n  const {\n    request,\n    error,\n    clearError\n  } = useHttp();\n  const {\n    id\n  } = useParams();\n  const url = `http://localhost:5000/api/uploads/${id}`;\n  const url_id = `http://localhost:5000/api/systems/${id}`;\n  useEffect(() => {\n    message(error);\n    clearError();\n  }, [error, message, clearError]); //Получение информации по системе\n\n  useEffect(async () => {\n    try {\n      const system_data = await request(url_id, 'GET');\n      setInfo_system(system_data);\n    } catch (error) {}\n  }, [isLoaded]);\n  console.log(info_system); //Получение списка всех файлов для конрктной системы\n\n  useEffect(async () => {\n    try {\n      const data = await request(url, 'GET');\n      setIsLoaded(true);\n      setItems(data);\n    } catch (error) {\n      setIsLoaded(true);\n    }\n  }, [isLoaded]); // Загрузка файла\n\n  const uploadScheme = selectedFile => {\n    const data = new FormData();\n    data.append('file', selectedFile, selectedFile.name);\n    axios.post(url, data);\n    setIsLoaded(false);\n  };\n\n  const dowlandScheme = (_id, name) => {\n    axios({\n      url: `http://127.0.0.1:5000/api/uploads/schema/${_id}`,\n      method: 'GET',\n      responseType: 'blob'\n    }).then(response => {\n      const url = window.URL.createObjectURL(new Blob([response.data]));\n      const link = document.createElement('a');\n      link.href = url;\n      link.setAttribute('download', name);\n      document.body.appendChild(link);\n      link.click();\n    });\n    setIsLoaded(false);\n  };\n\n  const removeScheme = (_id, fileSrc) => {\n    axios.delete(`http://127.0.0.1:5000/api/uploads/schema/${_id}`, {\n      data: {\n        fileSrc\n      }\n    });\n    setIsLoaded(false);\n  };\n\n  const editScheme = async (_id, name) => {\n    await axios.put(`http://127.0.0.1:5000/api/uploads/schema/${_id}`, {\n      name\n    });\n    setIsLoaded(false);\n  };\n\n  if (error) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 16\n      }\n    }, \"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \", error.message);\n  } else if (!isLoaded) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 16\n      }\n    }, \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\");\n  } else {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Navbar, Object.assign({}, info_system, {\n      uploadScheme: uploadScheme,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 17\n      }\n    })), items.map(obj => {\n      return /*#__PURE__*/React.createElement(TableSheme, Object.assign({\n        key: obj._id\n      }, obj, {\n        dowlandScheme: dowlandScheme,\n        removeScheme: removeScheme,\n        editScheme: editScheme,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 29\n        }\n      }));\n    }));\n  }\n}\n\nexport default SystemInfo;","map":{"version":3,"sources":["D:/Libr/front/src/Page/SystemInfo.jsx"],"names":["React","useState","useEffect","axios","TableSheme","Navbar","useParams","useHttp","useMessage","SystemInfo","props","items","setItems","info_system","setInfo_system","isLoaded","setIsLoaded","message","request","error","clearError","id","url","url_id","system_data","console","log","data","uploadScheme","selectedFile","FormData","append","name","post","dowlandScheme","_id","method","responseType","then","response","window","URL","createObjectURL","Blob","link","document","createElement","href","setAttribute","body","appendChild","click","removeScheme","fileSrc","delete","editScheme","put","map","obj"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\r\nimport axios from 'axios';\r\nimport TableSheme from '../Components/Table/TableSheme'\r\nimport Navbar from '../Components/Navbar/Navbar'\r\nimport { useParams } from 'react-router-dom'\r\nimport { useHttp } from '../hooks/http.hook'\r\nimport { useMessage } from '../hooks/message.hook'\r\n\r\n\r\n\r\nfunction SystemInfo(props) {\r\n\r\n    const [items, setItems] = useState([]);\r\n    const [info_system, setInfo_system] = useState([]);\r\n    const [isLoaded, setIsLoaded] = useState(false);\r\n\r\n\r\n    const message = useMessage()\r\n    const { request, error, clearError } = useHttp()\r\n\r\n    const { id } = useParams()\r\n    const url = `http://localhost:5000/api/uploads/${id}`\r\n    const url_id = `http://localhost:5000/api/systems/${id}`\r\n\r\n    useEffect(() => {\r\n        message(error)\r\n        clearError()\r\n    }, [error, message, clearError])\r\n\r\n    //Получение информации по системе\r\n    useEffect(async () => {\r\n        try {\r\n            const system_data = await request(url_id, 'GET')\r\n            setInfo_system(system_data)\r\n        } catch (error) {\r\n        }\r\n    }, [isLoaded])\r\n\r\n    console.log(info_system)\r\n\r\n    //Получение списка всех файлов для конрктной системы\r\n    useEffect(async () => {\r\n        try {\r\n            const data = await request(url, 'GET')\r\n            setIsLoaded(true);\r\n            setItems(data);\r\n        } catch (error) {\r\n            setIsLoaded(true);\r\n        }\r\n    }, [isLoaded])\r\n\r\n\r\n    // Загрузка файла\r\n    const uploadScheme = (selectedFile) => {\r\n        const data = new FormData()\r\n        data.append('file', selectedFile, selectedFile.name)\r\n        axios.post(url, data)\r\n        setIsLoaded(false)\r\n    }\r\n\r\n    const dowlandScheme = (_id, name) => {\r\n        axios({\r\n            url: `http://127.0.0.1:5000/api/uploads/schema/${_id}`,\r\n            method: 'GET',\r\n            responseType: 'blob',\r\n        }).then((response) => {\r\n            const url = window.URL.createObjectURL(new Blob([response.data]));\r\n            const link = document.createElement('a');\r\n            link.href = url;\r\n            link.setAttribute('download', name);\r\n            document.body.appendChild(link);\r\n            link.click();\r\n        });\r\n        setIsLoaded(false)\r\n    }\r\n\r\n    const removeScheme = (_id, fileSrc) => {\r\n        axios.delete(`http://127.0.0.1:5000/api/uploads/schema/${_id}`, {\r\n            data: {\r\n                fileSrc\r\n            }\r\n        });\r\n        setIsLoaded(false)\r\n    }\r\n\r\n    const editScheme = async (_id, name) => {\r\n        await axios.put(`http://127.0.0.1:5000/api/uploads/schema/${_id}`, { name })\r\n        setIsLoaded(false)\r\n    }\r\n\r\n\r\n    if (error) {\r\n        return <div>Ошибка: {error.message}</div>;\r\n    } else if (!isLoaded) {\r\n        return <div>Загрузка...</div>;\r\n    } else {\r\n        return (\r\n            <div>\r\n\r\n                <Navbar {...info_system}\r\n                    uploadScheme={uploadScheme}\r\n                />\r\n                {\r\n                    items.map((obj) => {\r\n                        return (\r\n                            <TableSheme key={obj._id} {...obj}\r\n                                dowlandScheme={dowlandScheme}\r\n                                removeScheme={removeScheme}\r\n                                editScheme={editScheme}\r\n                            />\r\n                        )\r\n                    })\r\n                }\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default SystemInfo\r\n"]},"metadata":{},"sourceType":"module"}